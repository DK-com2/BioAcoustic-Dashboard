# 🐦 BirdNet データベースビューワー

検索・フィルタ機能付きの統合ビューアー

## 🚀 起動方法

```bash
cd D:\Documents\BirdNET-SQL\streamlit_viewer
streamlit run db_viewer.py
```

## ✨ 機能

### 📊 統合ダッシュボード
- **検索・フィルタ**: セッション名、種名、信頼度による絞り込み
- **処理状況表示**: 音声・スペクトログラム生成状況の表示
- **データ統計**: 総検出数とファイル生成状況

### 🎧 プレビュー機能
- **音声プレイヤー**: 生成済みセグメントの再生
- **スペクトログラム表示**: 高解像度画像表示
- **ダウンロード機能**: WAV・PNGファイルの直接ダウンロード
- **ファイル生成**: 音声・スペクトログラムの即座生成（上書き対応）
- **処理状況**: ファイル存在確認

## 🎯 使用手順

### 1. データベース検索
1. **サイドバー**で検索条件を設定
   - セッション名選択
   - 種名フィルタ
   - 信頼度閾値設定
2. **🔍 検索実行**ボタンをクリック

### 2. データ確認・ファイル生成
1. 検索結果テーブルでレコードを選択
2. プレビューエリアで音声・スペクトログラムを確認
3. ファイルがない場合は生成ボタンで作成
   - 🎵 音声: 音声セグメントのみ生成
   - 📊 画像: スペクトログラムのみ生成
   - ✨ 両方: 音声+スペクトログラムを同時生成
4. 必要に応じてファイルをダウンロード

## 📁 ファイル構造

```
database/
├── audio_segments/           # 音声セグメント
│   └── {session_name}/
│       └── detection_001_Species_0.89.wav
├── spectrograms/            # スペクトログラム
│   └── {session_name}/
│       └── detection_001_Species_0.89.png
└── result.db               # メインデータベース
```

## 🔧 技術仕様

### ファイル命名規則
```
detection_{ID:03d}_{SafeSpeciesName}_{confidence:.2f}.{ext}
```

**例**: `detection_002_NorthernGoshawk_0.89.wav`

### 音声セグメント
- **フォーマット**: WAV（32-bit float）
- **品質**: 元ファイルのサンプリングレート維持

### スペクトログラム
- **フォーマット**: PNG（800x600ピクセル）
- **タイプ**: メル・スペクトログラム
- **カラーマップ**: viridis（紫→青→緑→黄色）
- **周波数範囲**: 0-8000Hz（鳥類検出最適化）

## 📊 処理状況の確認

### ダッシュボード表示
- **総検出数**: データベース内の全レコード数
- **音声生成済み**: 生成済みファイル数
- **スペクトログラム生成済み**: 生成済みファイル数
- **未処理**: まだ処理されていないレコード数

### テーブル表示
- **✅**: ファイル生成済み
- **❌**: ファイル未生成

### 品質評価システム
人間による品質評価状況を表示:
- **✅ 承認済み**: 人間が確認し、品質が承認されたデータ
- **❌ 却下**: 人間が確認し、品質に問題ありと判定
- **⏳ 評価待ち**: まだ人間による評価が行われていない
- **❓ 不明**: 評価ステータスが不明

## ⚠️ 注意事項

### 必要条件
1. **データベースファイル**: `result.db`が必要
2. **生成済みファイル**: 音声・画像ファイルが既に生成されている必要があります

### エラー対応
- **ファイルが見つからない**: ファイルパスの確認
- **音声再生エラー**: ファイル形式または破損の確認
- **画像表示エラー**: 画像ファイルの存在確認

## 🔍 トラブルシューティング

### よくある問題

#### 1. ファイルが表示されない
**原因**: ファイルパスが正しくない、またはファイルが存在しない
**解決**: データベースの`audio_segment_path`や`spectrogram_path`を確認

#### 2. 音声が再生されない
**原因**: 音声ファイルの破損またはフォーマット問題
**解決**: ファイルの存在と形式を確認

#### 3. 検索結果が表示されない
**原因**: データベース接続エラーまたは検索条件が厳しすぎる
**解決**: 検索条件をリセットしてから再試行

### デバッグ機能
- **ファイルパス表示**: 実際のファイル場所確認
- **リロード機能**: キャッシュクリアとデータ更新

## 🎯 最適な使用方法

### 効率的なワークフロー
1. **検索**: 目的の種やセッションで絞り込み
2. **プレビュー**: テーブルでレコードを選択して内容確認
3. **ファイル生成**: 必要に応じて音声・スペクトログラムを即座生成
4. **ダウンロード**: 必要なファイルを保存

### 検索のコツ
- **セッション名**: 特定の録音セッションに絞り込み
- **種名**: 興味のある鳥種のみ表示
- **信頼度**: 高品質な検出結果のみ確認
- **条件クリア**: 🗑️ボタンで簡単リセット

## 🎉 活用例

### 研究用途
- 特定種の音声パターン分析
- 検出精度の確認と評価
- 音声データの質的検証
- 承認済みデータの即座生成

### 教育用途
- 鳥類の鳴き声学習
- スペクトログラム解析の教材
- 音声識別技術の理解
- 品質確認済みサンプルの作成

### データ管理
- 大量検出結果の効率的確認
- 品質評価状況によるデータ選別
- CSVエクスポートでの外部解析
- 評価待ちデータの優先処理

---

**🎉 音声セグメントとスペクトログラムを効率的に閲覧・管理・生成！**
